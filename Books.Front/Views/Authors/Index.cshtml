@model IEnumerable<Books.Front.Models.AuthorVm>

@{
    ViewBag.Title = "Autores";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">Autores</h2>
        <small class="text-muted">Gestión de autores registrados</small>
    </div>
    <a class="btn btn-primary" href="@Url.Action("Create")">+ Nuevo autor</a>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Ciudad</th>
                        <th>Correo</th>
                        <th>Fecha nacimiento</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var a in Model)
                    {
                        <tr>
                            <td class="fw-semibold">@a.FullName</td>
                            <td>@a.City</td>
                            <td>@a.Email</td>
                            <td>@a.BirthDate.ToString("yyyy-MM-dd")</td>
                            <td class="text-end">
                                <a class="btn btn-sm btn-outline-secondary"
                                   href="@Url.Action("Edit", new { id = a.Id })">
                                    Editar
                                </a>

                                <button class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal"
                                        data-id="@a.Id"
                                        data-name="@a.FullName">
                                    Eliminar
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @if (!Model.Any())
            {
                <div class="text-center text-muted py-4">
                    No hay autores registrados todavía.
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal Delete -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                ¿Seguro que quieres eliminar el autor <strong id="authorName"></strong>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>

                @using (Html.BeginForm("Delete", "Authors", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("id", "", new { id = "authorId" })
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                }
            </div>
        </div>
    </div>
</div>

<script>
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const id = button.getAttribute('data-id');
        const name = button.getAttribute('data-name');

        document.getElementById('authorId').value = id;
        document.getElementById('authorName').textContent = name;
    });
</script>
