@model IEnumerable<Books.Front.Models.BookVm>

@{
    ViewBag.Title = "Libros";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">Libros</h2>
        <small class="text-muted">Gestión de libros registrados</small>
    </div>
    <a class="btn btn-primary" href="@Url.Action("Create")">+ Nuevo libro</a>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Título</th>
                        <th>Año</th>
                        <th>Género</th>
                        <th>Páginas</th>
                        <th>Autor</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var b in Model)
                    {
                        <tr>
                            <td class="fw-semibold">@b.Title</td>
                            <td>@b.Year</td>
                            <td>@b.Genre</td>
                            <td>@b.Pages</td>
                            <td>@b.AuthorName</td>
                            <td class="text-end">
                                <a class="btn btn-sm btn-outline-secondary"
                                   href="@Url.Action("Edit", new { id = b.Id })">
                                    Editar
                                </a>

                                <button class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal"
                                        data-id="@b.Id"
                                        data-title="@b.Title">
                                    Eliminar
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @if (!Model.Any())
            {
                <div class="text-center text-muted py-4">
                    No hay libros registrados todavía.
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal Delete -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                ¿Seguro que quieres eliminar el libro <strong id="bookTitle"></strong>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>

                @using (Html.BeginForm("Delete", "Books", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("id", "", new { id = "bookId" })
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                }
            </div>
        </div>
    </div>
</div>

<script>
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const id = button.getAttribute('data-id');
        const title = button.getAttribute('data-title');

        document.getElementById('bookId').value = id;
        document.getElementById('bookTitle').textContent = title;
    });
</script>
